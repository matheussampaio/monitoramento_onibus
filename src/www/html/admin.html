<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Administrador</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap -->
  <link href="css/bootstrap.css" rel="stylesheet" media="screen">

  <script type="text/javascript">
    function submenu(div) {
        for (var i=0; i < document.getElementById('sidebar_content_ul').children.length; i++) {
            document.getElementById('sidebar_content_ul').children[i].setAttribute("class", "");
        }

        for (var j=0; j < document.getElementById('body_content').children.length; j++) {
            document.getElementById('body_content').children[j].setAttribute("class", "hide");
        }

        document.getElementById('body_content_' + div).setAttribute("class", "");
        document.getElementById('submenu_' + div).setAttribute("class", "active");
    };


  function adicionarOnibus() {
    var isOk = true;

    var placa = document.getElementById("placaOnibusAdicionar").value;
    var numeroRota = document.getElementById("numeroRota").value;
    var cont = 0;

    document.getElementById("errorPlaca").innerHTML = "";
    document.getElementById("errorNumero").innerHTML = "";

    if (placa.length != 8) {
    document.getElementById("errorPlaca").innerHTML =  '<div class="alert fade in span6">Placa de Ônibus não pode ser vázia.</div>';
    isOk = false;
    }

    for (var i = 0 ; i < placa.length; i++) {
    if (cont < 3) {
      if (!isNaN(placa[i])) {
        document.getElementById("errorPlaca").innerHTML =  '<div class="alert fade in span6">Placa de Ônibus deve iniciar com 3 Letras.</div>';
        isOk = false;
      }
    } else if (cont == 3) {
      if (placa[i] != "-") {
        document.getElementById("errorPlaca").innerHTML =  '<div class="alert fade in span6">Placa deve ter o fomato LLL-NNNN.</div>';
        isOk = false;
      }
    } else {
      if (isNaN(placa[i])) {
        document.getElementById("errorPlaca").innerHTML =  '<div class="alert fade in span6">Placa deve ter o fomato LLL-NNNN.</div>';
        isOk = false;
      }
    }

    cont++;
    };

    if (numeroRota.length == 0) {
      document.getElementById("errorNumero").innerHTML =  '<div class="alert fade in span6">Número da Rota não pode ser vázio.</div>';
      isOk = false;
    } else if (isNaN(numeroRota)) {
      document.getElementById("errorNumero").innerHTML =  '<div class="alert fade in span6">O número da rota precisa ser um número.</div>';
      isOk = false;
    }

    return isOk;
  }

  </script>
</head>

<body style="margin-top: 40px">

    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.js"></script>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <a class="brand" href="./home">Monitoramento de Ônibus</a>
        <div class="container">
          <ul class="nav" >
            <li><a href="./home">Home</a></li>
            <li><a href="./horarios">Horários</a></li>
            <li class="active"><a href="./admin">Administração</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="row">
        <div class="span12" id="header" style="padding: 50px"></div>
      </div>
      <!--Sidebar content-->
      <div class="span3" style="margin-left: 100px; margin-right: 100px">
        <ul class="nav nav-tabs nav-stacked" id="sidebar_content_ul">
          <li class="active" id="submenu_onibus"><a href="#onibus" onclick="javascript:submenu('onibus')">Ônibus</i></a></li>
          <li id="submenu_rotas"><a href="#rotas" onclick="javascript:submenu('rotas')">Rotas</a></li>
          <li id="submenu_pontoonibus"><a href="#pontoonibus" onclick="javascript:submenu('pontoonibus')">Pontos de Ônibus</a></li>
          <li id="submenu_fugarotas"><a href="#fugarotas" onclick="javascript:submenu('fugarotas')">Fugas de Rotas</a></li>
        </ul>
      </div>

      <!--Body content-->
      <div class="span9" id="body_content" style="margin-left: 100px">
        <div id="body_content_onibus">
            <h3>Adicionar Ônibus</h3> <br>

            <form id="onibusForm" class="form-horizontal" onsubmit="return adicionarOnibus()" method="POST" action="adicionarOnibus">
              <div class="control-group">
                <label class="control-label" for="placaOnibusAdicionar">Placa do Ônibus</label>
                <div class="controls">
                  <input type="text" id="placaOnibusAdicionar" name="placaOnibusAdicionar" placeholder="Placa (LLL-NNNN)">
                </div>
                <div id="errorPlaca"></div>
              </div>
              <div class="control-group">
                <label class="control-label" for="numeroRota">Número da Rota</label>
                <div class="controls">
                  <input type="text" id="numeroRota" name="numeroRota" placeholder="Número">
                </div>
                <div id="errorNumero"></div>
              </div>
              <div class="control-group">
                <div class="controls">
                  <button class="submit btn" type="submit">Adicionar</button>
                </div>
              </div>
            </form>

            <hr>

            <h3>Remover Ônibus</h3> <br>

            <form class="form-horizontal">
              <div class="control-group">
                <label class="control-label" for="placaOnibusRemover">Placa do Ônibus</label>
                <div class="controls">
                  <input type="text" id="placaOnibusRemover" placeholder="Placa (LLL-NNNN)">
                </div>
              </div>
              <div class="control-group">
                <div class="controls">
                  <button type="submit" class="btn">Remover</button>
                </div>
              </div>
            </form>
        </div>

        <div class="hide" id="body_content_rotas">
            Rotas!
        </div>

        <div class="hide" id="body_content_pontoonibus">
            Pontos de Onibus!
        </div>

        <div class="hide" id="body_content_fugarotas">
            <h3 class="text-center">Fugas em Aberto</h3>

            <% if (fugarota.length == 0) { %>
                <br>
                <p class="text-center muted bold">Não há nenhuma Fuga de Rota em aberto.</p>
            <% } else { %>

                <table class="table">
                <thead>
                <tr>
                    <td><div align="center"><b>Placa do Ônibus</b></div></td>
                    <td><div align="center"><b>Inicio da Fuga</b></div></td>
                    <td><div align="center"><b>Final da Fuga</b></div></td>
                    <td><div align="center"><b>Marcar como Resolvido</b></div></td>
                <tr>
                </thead>

                <% for (var i = 0; i < fugarota.length; i++) { %>
                    <tr>
                        <td><div align="center"><%= fugarota[i].placa %></div></td>
                        <td><div align="center"><%= fugarota[i].horarioinicio %></div></td>
                        <% if (!fugarota[i].horariofinal) { %>
                            <td><div align="center">-</div></td>
                        <% } else { %>
                        <td><div align="center"><%= fugarota[i].horariofinal %></div></td>
                        <% } %>
                        <td><div align="center">
                            <form action="fugarota" method="POST">
                                <input type="hidden" name="idFugaRota" id="idFugaRota" value=<%= fugarota[i].id_fugarota %>>
                                <input type="hidden" name="idOnibus" id="idOnibus" value=<%= fugarota[i].id_onibus %>>
                                <button class"btn" type="submit"><i class="icon-ok"></i></button>
                            </form>
                        </div></td>
                    </tr>
                <% } %>
                </table>

            <% } %>

            <br><br>

            <h3 class="text-center">Histórico de Fugas</h3>

            <% if (fugarotahistorico.length == 0) { %>
                <br>
                <p class="text-center muted bold">Não há nenhuma Fuga de Rota resolvida.</p>
            <% } else { %>

                <table class="table">
                <thead>
                <tr>
                    <td><div align="center"><b>Placa do Ônibus</b></div></td>
                    <td><div align="center"><b>Inicio da Fuga</b></div></td>
                    <td><div align="center"><b>Final da Fuga</b></div></td>
                <tr>
                </thead>

                <% for (var i = 0; i < fugarotahistorico.length; i++) { %>
                    <tr>
                        <td><div align="center"><%= fugarotahistorico[i].placa %></div></td>
                        <td><div align="center"><%= fugarotahistorico[i].horarioinicio %></div></td>
                        <% if (!fugarotahistorico[i].horariofinal) { %>
                            <td><div align="center">-</div></td>
                        <% } else { %>
                        <td><div align="center"><%= fugarotahistorico[i].horariofinal %></div></td>
                        <% } %>
                    </tr>
                <% } %>
                </table>

            <% } %>
        </div>

      </div>
    </div>
</body>

</html>
