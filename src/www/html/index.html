<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="EN">
<head>
    <style>
    html,body {
        height: 95%;
        width: 99%;
    }
    #map_id {
        width: 100%;
        height: 100%;
        border: 1px solid black;
    }
    </style>
    <script src='http://maps.google.com/maps/api/js?v=3&amp;sensor=false'></script>
    <script src="http://openlayers.org/api/OpenLayers.js"></script>
    <script type="text/javascript">
    var map, layer_onibus;

    var server = "http://192.168.1.244:8080/geoserver/GO/wms";

    var refreshing = false;
    var refreshID;

    function init() {

        var layer_rota_500 = new OpenLayers.Layer.WMS(
            "Rota: 500", server,
            {layers: 'gonibus:rota500view', transparent: "true"},
            {singleTile: false, isBaseLayer: false, visibility: true}
            );

        var layer_rota_505 = new OpenLayers.Layer.WMS(
            "Rota: 505", server,
            {layers: 'gonibus:rota505view', transparent: "true"},
            {singleTile: false, isBaseLayer: false, visibility: true}
            );

        var layer_rota_555 = new OpenLayers.Layer.WMS(
            "Rota: 555", server,
            {layers: 'gonibus:rota555view', transparent: "true"},
            {singleTile: false, isBaseLayer: false, visibility: true}
            );

        var layer_pontos_onibus = new OpenLayers.Layer.WMS(
            "Pontos de Ônibus", server,
            {layers: 'gonibus:pontoonibus', transparent: "true"},
            {singleTile: true, isBaseLayer: false, visibility: true}
            );

        layer_onibus = new OpenLayers.Layer.WMS(
            "Ônibus", server,
            {layers: 'gonibus:lastlocalization', transparent: "true"},
            {singleTile: true, isBaseLayer: false, visibility: true}
            );


        var options = {
            projection: 'EPSG:3857',
            center: new OpenLayers.LonLat(-3996296.2385206,-807660.81172368),
            numZoomLevels: 20,
            zoom: 15
        }


        map = new OpenLayers.Map('map_id', options);

        layer_googleStr = new OpenLayers.Layer.Google("Google Streets",{numZoomLevels: 20});

        map.addLayers([layer_googleStr, layer_rota_500, layer_rota_505, layer_rota_555, layer_pontos_onibus, layer_onibus]);

        map.addControl(new OpenLayers.Control.LayerSwitcher());
        map.addControl(new OpenLayers.Control.MousePosition());

        map.setCenter(new OpenLayers.LonLat(-3996296.2385206,-807660.81172368), 14);
    }

    function refresh() {
        map.getLayersByName('Ônibus')[0].redraw(true);
        console.log('refreshing...');
    }

    function toggleRefresh() {
        refreshing = !refreshing;

        if (!refreshing) {
            clearInterval(refreshID);
        } else {
            refreshID = window.setInterval( refresh, 5000);
        }

        console.log('Refresh toggle: ' + refreshing);
    }

    </script>

</head>
<body onload="toggleRefresh()">

    <div id="map_id">
        <script>
        init();
        // toggleRefresh();
        </script>
    </div>
    <div>
        <button id="refresh" type="button" onclick="toggleRefresh()">Toggle Refresh</button>
    </div>

</body>

</html>
